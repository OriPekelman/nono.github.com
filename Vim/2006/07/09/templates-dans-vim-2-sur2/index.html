
<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7 ie" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8 ie" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9 ie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<title>Templates dans vim 2 / 2</title>
	<meta name="author" content="Bruno Michel">
	<link href='/assets/themes/the-minimum/css/style.css' rel="stylesheet" media="all">
	<link href="/atom.xml" rel="alternate" title="Templates dans vim 2 / 2" type="application/atom+xml">
    <script src="/assets/themes/the-minimum/modernizr.min.js"></script>
</head>
<body>

<div id="page" class="hentry">
	<header class="the-header">
		<div class="unit-head">
			<div class="unit-inner unit-head-inner">
				<p class="logo"><a href="/">M'enfin ?!?</a></p>
				<nav class="nav-global">
					<ul>
						<li class="archive"><a href="/archive.html">archive</a></li>
						<li class="category"><a href="/categories.html">catégories</a></li>
					</ul>
				</nav>
			</div><!-- unit-inner -->
		</div><!-- unit-head -->
	</header>
	<div class="body" role="main">
		<div class="unit-body">
			<div class="unit-inner unit-body-inner">
				<div class="entry-content">
					
<article class="unit-article layout-post">
	<div class="unit-inner unit-article-inner">
		<div class="content">
			<header>
				<div class="unit-head">
					<div class="unit-inner unit-head-inner">
						<h1 class="h2 entry-title">Templates dans vim 2 / 2</h1>
					</div><!-- unit-inner -->
				</div><!-- unit-head -->
			</header>

			<div class="bd">
				<div class="entry-content">
					<p>Comme promis, nous allons donc voir comment avoir des templates un peu plus dynamiques. Le langage de script de vim n'étant pas des plus sympathiques, je préfère appeler un programme externe.
Pour cela, nous allons remplacer la ligne que nous avions insérée dans le fichier vimrc par celle-là :</p>
<div class="highlight"><pre><code class="vim">au <span class="nb">BufNewFile</span> * <span class="m">0</span>r<span class="p">!</span> <span class="p">~</span><span class="sr">/.vim/</span>skeleton.rb
</code></pre>
</div>

<p>Ici, c'est un script en ruby (<code>skeleton.rb</code>) qui est appelé.
Pour le moment, ce script ne reçoit aucun paramètre.
Pas terrible pour savoir quel template utiliser&nbsp;!
Pour régler ce problème, nous pouvons passer par exemple le nom du fichier, avec son chemin complet.
Il suffit de rajouter <code>%:p</code> toujours à la me ligne du fichier vimrc.
<code>%</code> indique le fichier courant, et <code>:p</code> est un modificateur pour avoir le chemin complet.</p>

<p>Mais, <strong>ViM</strong> fait déjà de la détection de <em>filetype</em>, aussi il peut être intéressant de passer ce <em>filetype</em> à notre script.
Pour cela, nous allons encore modifier notre ligne :</p>
<div class="highlight"><pre><code class="vim">au <span class="nb">BufNewFile</span> * :exe<span class="p">(</span><span class="s2">&quot;0r! ~/.vim/skeleton.rb %:p &quot;</span> . &amp;<span class="k">filetype</span><span class="p">)</span>
</code></pre>
</div>

<p><strong>Note</strong> : comme il n'est pas possible à ma connaissance de passer directement le filtype à la commande r!, je construit d'abord la chaîne de cractère avec toute la commande et le filetype, puis je l'éxécute.</p>

<p>Maintenant que nous pouvons appeller un script avec le chemin du fichier et son <em>filetype</em>, je pense qu'on peut dire que c'est gagné.
Voici à titre d'exemple le script que j'utilise :</p>
<div class="highlight"><pre><code class="ruby"><span class="c1">#!/usr/bin/env ruby</span>
<span class="c1"># Author: Bruno Michel &lt;bmichel@menfin.info&gt;</span>
<span class="c1"># Licence: MIT &lt;http://www.opensource.org/licenses/mit-license.html&gt;</span>

<span class="nb">require</span> <span class="s1">&#39;erb&#39;</span>


<span class="no">SKELETON_DIR</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">expand_path</span><span class="p">(</span><span class="s2">&quot;~/.vim/skeleton&quot;</span><span class="p">);</span>
<span class="no">EXTENSION</span>  <span class="o">=</span> <span class="s2">&quot;erb&quot;</span>

<span class="n">file</span><span class="p">,</span> <span class="n">filetype</span> <span class="o">=</span> <span class="no">ARGV</span>
<span class="n">filename</span>  <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
<span class="n">skeletons</span> <span class="o">=</span> <span class="o">[</span><span class="n">filename</span><span class="p">,</span> <span class="n">filetype</span><span class="o">]</span>
<span class="n">skeleton</span>  <span class="o">=</span> <span class="n">skeletons</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">s</span><span class="o">|</span>
    <span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="no">SKELETON_DIR</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">s</span><span class="si">}</span><span class="s2">.</span><span class="si">#{</span><span class="no">EXTENSION</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="p">}</span><span class="o">.</span><span class="n">find</span> <span class="p">{</span> <span class="o">|</span><span class="n">s</span><span class="o">|</span>
    <span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="no">File</span><span class="o">.</span><span class="n">readable?</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="p">}</span>

<span class="nb">exit</span> <span class="k">if</span> <span class="n">skeleton</span><span class="o">.</span><span class="n">nil?</span>

<span class="no">File</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">skeleton</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span>
    <span class="nb">puts</span> <span class="no">ERB</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">,</span> <span class="kp">nil</span><span class="p">,</span> <span class="s1">&#39;&lt;&gt;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">result</span><span class="p">(</span><span class="nb">binding</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>
</div>

<p><strong>Note</strong> : si vous voulez utiliser ce script, n'oubliez pas de le rendre exécutable (<code>chmod a+x ~/.vim/skeleton.rb</code>)</p>

<p>Ce script va chercher un fichier <code>.erb</code> dans le répertoire <code>~/.vim/skeleton</code> dont le nom correspond soit au nom du nouveau fichier, soit à son filetype.
Et dans ce répertoire, on trouve, par exemple, <code>ruby.erb</code> :</p>
<div class="highlight"><pre><code class="ruby"><span class="c1">#!/usr/bin/env ruby</span>
<span class="c1"># Author: Bruno Michel &lt;bmichel@menfin.info&gt;</span>
<span class="c1"># Licence: MIT &lt;http://www.opensource.org/licenses/mit-license.html&gt;</span>
</code></pre>
</div>

<p>ou <code>README.erb</code> :</p>
<div class="highlight"><pre><code class="text">&lt;%= `figlet -c README` %&gt;
&lt;%# figlet: http://www.figlet.org %&gt;

Author: Bruno Michel &lt;bmichel@menfin.info&gt;
Date: &lt;%= Date.today.strftime(&quot;%d/%m/%y&quot;) %&gt;
Time: &lt;%= Time.now.strftime(&quot;%H:%M:%S&quot;) %&gt;
&lt;% directory = File.dirname(file) %&gt;
Project: &lt;%= File.split(directory).last %&gt;
</code></pre>
</div>

<p>Et voilà, mission accomplie, nous avons des templates dynamiques, avec notamment la possibilité d'insérer la date ou l'heure courante.</p>

					<div class="meta">
						<p class="date-publish">
							Publié le  
							<date class="date-pub" title="2006-07-09T00:00:00+02:00" datetime="2006-07-09T00:00:00+02:00" pubdate>
                                <span class="day">
                                    09
                                </span>/<span class="month">
                                    07
                                </span>/<span class="year">
                                    2006
                                </span>
							</date>
						</p>
						<ul class="list-category list-linear">
							<li class="list-head">Catégorie : </li>
							
							


  
     
    	<li><a href="/categories.html#Vim-ref">
    		Vim <span>8</span>
    	</a></li>
    
  


						</ul>
					</div><!-- meta -->
				</div><!-- entry-content -->
				<div class="misc-content">
					


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'menfin'; // required: replace example with your forum shortname
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




				</div><!-- misc-content -->
				
			</div><!-- bd -->
			<footer class="unit-foot">
				<div class="unit-inner unit-foot-inner">
					<nav class="pagination">
						<ul>
							
							<li class="prev"><a class="internal" rel="prev"  href="/Vim/2006/07/05/templates-dans-vim-1-sur2" title="View Templates dans vim 1 / 2">&laquo; Templates dans vim 1 / 2</a></li>
							
							
							<li class="pipe"> | </li>
							
							
							<li class="next"><a class="internal" rel="next"  href="/Vim/2006/07/10/fichier-de-syntaxe-vim-pour-dotclear" title="View Coloration syntaxique dans Vim pour les billets Dotclear">Coloration syntaxique dans Vim pour les billets Dotclear &raquo;</a></li>
							
						</ul>
					</nav>
					<p class="gotop">
						<a href="#page">Back to Top</a>
					</p>
				</div>
			</footer>

		</div><!-- content -->
	</div><!-- unit-inner -->
</article>


				</div>
			</div><!-- unit-inner -->
		</div><!-- unit-body -->
	</div><!-- body -->
	<footer class="the-footer">
		<div class="unit-foot">
			<div class="unit-inner unit-foot-inner">
				<div class="misc vcard">
					<img src="/public/bruno.png" alt="" class="avatar" />
					<h4>À propos</h4>
					<ul>
						<li class="contact"><address><span class="author fn n">Bruno Michel</span> - <span class="fn email">bmichel AT menfin DOT info</span></address></li>
						<li class="github"><a href="http://github.com/nono/" rel="me">github.com/nono</a></li>
						<li class="twitter"><a href="http://twitter.com/brmichel/" rel="me">twitter.com/brmichel</a></li>
						<li class="rss"><a href="/atom.xml">Subscribe to ATOM feed</a></li>
					</ul>
				</div><!-- misc -->
				<p class="licence">
                    ♡2006 by Bruno Michel. Copying is an act of love. Please copy and share.
				</p>
			</div><!-- unit-foot-inner -->
		</div><!-- unit-foot -->
	</footer>
</div><!-- page -->
<script>
/*! A fix for the iOS orientationchange zoom bug.Script by @scottjehl, rebound by @wilto. MIT License.*/
(function(j){var i=j.document;if(!i.querySelectorAll){return}var l=i.querySelectorAll("meta[name=viewport]")[0],a=l&&l.getAttribute("content"),h=a+", maximum-scale=1.0",d=a+", maximum-scale=10.0",g=true,c=j.orientation,k=0;if(!l){return}function f(){l.setAttribute("content",d);g=true}function b(){l.setAttribute("content",h);g=false}function e(m){c=Math.abs(j.orientation);k=Math.abs(m.gamma);if(k>8&&c===0){if(g){b()}}else{if(!g){f()}}}j.addEventListener("orientationchange",f,false);j.addEventListener("deviceorientation",e,false)})(this);
</script>

  
</body>
</html>

